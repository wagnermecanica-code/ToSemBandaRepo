REFACTOR_PROFILE.md
Você é um arquiteto Flutter sênior especialista em Clean Architecture + Riverpod 2.5+ + Firebase.

Meu projeto atual é o WeGig (app de músicos com múltiplos perfis, Instagram-style). Ele já tem:
- Riverpod para estado global (ProfileProvider, activeProfileProvider, etc.)
- Firebase Auth + Firestore
- Telas em lib/pages/
- Serviços em lib/services/
- Providers em lib/providers/
- Widgets reutilizáveis em lib/widgets/
- A feature AUTH já foi migrada com sucesso para features/auth/ (data/domain/presentation)

Quero migrar INCREMENTALMENTE para a estrutura **feature-first + clean architecture** sem reescrever tudo de uma vez e sem quebrar o app.

Estrutura alvo final (exatamente assim):

lib/
├── core/
│   ├── di/               → todos os @riverpod globais (profileProvider, activeProfileProvider, etc.)
│   ├── error/            → failures.dart
│   ├── network/          → (se precisar)
│   ├── services/         → PushNotificationService, CacheService, etc.
│   ├── theme/            → app_colors.dart, app_theme.dart
│   ├── utils/            → extensions, constants, debouncer.dart
│   └── widgets/          → widgets globais (MessageBubble, EmptyState, ProfileSwitcherBottomSheet, etc.)
│
├── features/
│   ├── auth/             → JÁ MIGRADO
│   ├── profile/          → ViewProfilePage, EditProfilePage, ProfileFormPage, ProfileSwitcher
│   ├── home/             → HomePage, SearchPage
│   ├── post/             → PostPage, EditPostPage, PostDetailPage
│   ├── messages/         → MessagesPage, ChatDetailPage
│   ├── notifications/   → NotificationsPage, NotificationSettingsPage
│   └── settings/         → SettingsPage
│
├── app/
│   ├── routes.dart       → go_router com typed routes
│   └── app.dart
└── main_dev.dart / main_prod.dart

REGRAS OBRIGATÓRIAS PARA A MIGRAÇÃO:

1. Faça UMA feature por vez (agora é a vez do PROFILE)
2. Nunca quebre o build. Todas as mudanças devem compilar a cada etapa.
3. Use movimentação física de arquivos + refatoração automática de imports.
4. Mantenha o mesmo comportamento visual e funcional (especialmente troca de perfil e badge counters).
5. Use riverpod_generator com @riverpod sempre que possível.
6. Use freezed + json_serializable nos models (especialmente Profile).
7. Crie Repository puro (interface) e RepositoryImpl que chama Firebase.
8. Mova providers locais para features/profile/presentation/providers/
9. Providers GLOBAIS (profileProvider, activeProfileProvider, unreadNotificationCountForProfileProvider, unreadMessageCountForProfileProvider) ficam em core/di/
10. Use const constructors sempre que possível.
11. Atualize os imports em todas as telas afetadas automaticamente (HomePage, BottomNav, MessagesPage, NotificationsPage, etc.).
12. Não delete nada ainda — só mova e ajuste caminhos.
13. Mantenha 100% de retrocompatibilidade com código legado.

TAREFA ATUAL — MIGRAÇÃO COMPLETA DA FEATURE PROFILE:

Agora migre completamente a funcionalidade de múltiplos perfis do WeGig.

O que deve ser feito:

1. Criar a estrutura completa:
   features/profile/
   ├── data/
   │   ├── datasources/
   │   │   └── profile_remote_datasource.dart
   │   └── repositories/
   │       └── profile_repository_impl.dart
   ├── domain/
   │   ├── entities/
   │   │   └── profile_entity.dart (com freezed + json_serializable)
   │   ├── repositories/
   │   │   └── profile_repository.dart (interface pura)
   │   └── usecases/
   │       ├── create_profile.dart
   │       ├── update_profile.dart
   │       ├── switch_active_profile.dart
   │       ├── delete_profile.dart
   │       └── load_profiles_summary.dart
   └── presentation/
       ├── pages/
       │   ├── view_profile_page.dart
       │   ├── edit_profile_page.dart
       │   ├── profile_form_page.dart
       │   └── profile_switcher_bottom_sheet.dart
       ├── providers/          → (se precisar de providers locais)
       └── widgets/            → widgets específicos do perfil

2. Mover fisicamente os arquivos atuais:
   - lib/pages/view_profile_page.dart     → features/profile/presentation/pages/
   - lib/pages/edit_profile_page.dart    → features/profile/presentation/pages/
   - lib/pages/profile_form_page.dart    → features/profile/presentation/pages/
   - lib/pages/profile_switcher_bottom_sheet.dart → features/profile/presentation/pages/ ou core/widgets/ (se for global)

3. Manter os providers GLOBAIS em core/di/:
   - profileProvider
   - activeProfileProvider
   - unreadNotificationCountForProfileProvider
   - unreadMessageCountForProfileProvider
   Mas agora eles devem injetar o novo ProfileRepository

4. Garantir que os seguintes recursos continuem funcionando 100%:
   - Troca de perfil por long press no avatar (BottomNav)
   - Badge counters (sininho e mensagens) aparecendo apenas em perfis não ativos
   - Real-time updates ao trocar de perfil (Home, Messages, Notifications recarregam automaticamente)
   - ProfileSwitcherBottomSheet com animação e badges

5. Use freezed para ProfileEntity com todos os campos atuais (name, photoUrl, isBand, city, location, instruments, genres, level, age, bio, youtubeLink, etc.)

6. Crie facades se necessário para código legado continuar funcionando sem alterações.

7. Atualize todos os imports quebrados automaticamente.

Quando terminar toda a migração com sucesso e o app continuar funcionando perfeitamente (testado troca de perfil + badges), responda exatamente com:

"Profile migration complete — ready for Post feature"

Faça isso com precisão cirúrgica, uma mudança por vez, explicando o que está movendo e por quê. Não pule etapas. Comece agora.
Passo 1: Criar a estrutura de diretórios para a feature profile.

Ação:
- Crie as seguintes pastas e subpastas em `lib/features/profile/`:
    - data/datasources/
    - data/repositories/
    - domain/entities/
    - domain/repositories/
    - domain/usecases/
    - presentation/pages/
    - presentation/providers/
    - presentation/widgets/

Motivo:
- Isso prepara o terreno para migrar os arquivos de profile para a arquitetura feature-first + clean architecture, sem quebrar o build e mantendo retrocompatibilidade.

Próximo passo: mover os arquivos de página de perfil para a nova estrutura.

Comece a migração agora.
